<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîç Debug - Problema Unicode</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }
        .test-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            border-left: 5px solid #007bff;
        }
        .formula {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            border: 1px solid #dee2e6;
            font-family: monospace;
        }
        .original {
            background: #fff3cd;
            padding: 10px;
            border-radius: 5px;
            margin: 5px 0;
            color: #856404;
        }
        .converted {
            background: #d1ecf1;
            padding: 10px;
            border-radius: 5px;
            margin: 5px 0;
            font-size: 1.2em;
            color: #0c5460;
        }
        .debug-info {
            background: #e2e3e5;
            padding: 10px;
            border-radius: 5px;
            margin: 5px 0;
            font-family: monospace;
            font-size: 0.9em;
        }
        .status {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            margin: 5px;
        }
        .status.working {
            background: #d4edda;
            color: #155724;
        }
        .status.problem {
            background: #f8d7da;
            color: #721c24;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px 5px;
        }
        button:hover {
            background: #0056b3;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Debug - Problema Unicode</h1>
        
        <div class="test-section">
            <h2>üßÆ Teste de Convers√£o Unicode</h2>
            <p>Vamos testar se a fun√ß√£o convertMathToUnicode est√° funcionando corretamente:</p>
            
            <button onclick="testUnicodeConversion()">Testar Convers√£o</button>
            <button onclick="testRealWorldExample()">Testar Exemplo Real</button>
            
            <div id="test-results"></div>
        </div>

        <div class="test-section">
            <h2>üîç Poss√≠veis Causas do Problema</h2>
            
            <div class="formula">
                <h3>1. Conte√∫do n√£o est√° passando pela convers√£o</h3>
                <div class="debug-info">
                    - Verificar se MarkdownRenderer est√° sendo usado<br>
                    - Verificar se convertMathToUnicode est√° sendo chamado<br>
                    - Verificar se h√° cache de conte√∫do antigo
                </div>
            </div>
            
            <div class="formula">
                <h3>2. Conte√∫do vem j√° processado da IA</h3>
                <div class="debug-info">
                    - A IA pode estar retornando LaTeX mesmo com instru√ß√µes<br>
                    - Pode haver conflito entre diferentes prompts<br>
                    - Pode ser conte√∫do em cache de sess√µes anteriores
                </div>
            </div>
            
            <div class="formula">
                <h3>3. Problema de renderiza√ß√£o</h3>
                <div class="debug-info">
                    - ReactMarkdown pode estar interferindo<br>
                    - CSS pode estar ocultando caracteres Unicode<br>
                    - Fontes podem n√£o suportar s√≠mbolos matem√°ticos
                </div>
            </div>
        </div>

        <div class="test-section">
            <h2>üõ†Ô∏è Solu√ß√µes Propostas</h2>
            
            <div class="formula">
                <h3>Solu√ß√£o 1: For√ßar convers√£o em todos os pontos</h3>
                <div class="debug-info">
                    - Adicionar convertMathToUnicode em todos os componentes<br>
                    - Garantir que nenhum conte√∫do escape da convers√£o<br>
                    - Adicionar logs para debug
                </div>
            </div>
            
            <div class="formula">
                <h3>Solu√ß√£o 2: Melhorar instru√ß√µes da IA</h3>
                <div class="debug-info">
                    - Tornar instru√ß√µes de Unicode mais espec√≠ficas<br>
                    - Adicionar exemplos expl√≠citos<br>
                    - Usar instru√ß√µes mais agressivas
                </div>
            </div>
            
            <div class="formula">
                <h3>Solu√ß√£o 3: P√≥s-processamento obrigat√≥rio</h3>
                <div class="debug-info">
                    - Aplicar convers√£o em todas as respostas da IA<br>
                    - N√£o confiar apenas na IA para seguir instru√ß√µes<br>
                    - Garantir convers√£o no backend
                </div>
            </div>
        </div>

        <div class="test-section">
            <h2>üìã Checklist de Verifica√ß√£o</h2>
            
            <div class="formula">
                <input type="checkbox" id="check1"> <label for="check1">MarkdownRenderer est√° sendo usado?</label><br>
                <input type="checkbox" id="check2"> <label for="check2">convertMathToUnicode est√° sendo chamado?</label><br>
                <input type="checkbox" id="check3"> <label for="check3">Instru√ß√µes de Unicode est√£o nos prompts?</label><br>
                <input type="checkbox" id="check4"> <label for="check4">N√£o h√° cache de conte√∫do antigo?</label><br>
                <input type="checkbox" id="check5"> <label for="check5">Fontes suportam s√≠mbolos Unicode?</label><br>
                <input type="checkbox" id="check6"> <label for="check6">CSS n√£o est√° interferindo?</label>
            </div>
        </div>
    </div>

    <script>
        // Fun√ß√£o de convers√£o Unicode (baseada no c√≥digo real)
        function convertMathToUnicode(text) {
            if (!text) return '';
            
            return text
                // Fun√ß√µes trigonom√©tricas
                .replace(/\\sin/g, 'sin')
                .replace(/\\cos/g, 'cos')
                .replace(/\\tan/g, 'tan')
                .replace(/\\cot/g, 'cot')
                .replace(/\\sec/g, 'sec')
                .replace(/\\csc/g, 'csc')
                
                // Fra√ß√µes
                .replace(/\\frac\{([^}]+)\}\{([^}]+)\}/g, '$1‚ÅÑ$2')
                
                // Sobrescritos
                .replace(/\^(\d+)/g, (match, num) => {
                    const superscripts = {
                        '0': '‚Å∞', '1': '¬π', '2': '¬≤', '3': '¬≥', '4': '‚Å¥', '5': '‚Åµ',
                        '6': '‚Å∂', '7': '‚Å∑', '8': '‚Å∏', '9': '‚Åπ'
                    };
                    return num.split('').map(d => superscripts[d] || d).join('');
                })
                
                // Subscritos
                .replace(/_(\d+)/g, (match, num) => {
                    const subscripts = {
                        '0': '‚ÇÄ', '1': '‚ÇÅ', '2': '‚ÇÇ', '3': '‚ÇÉ', '4': '‚ÇÑ', '5': '‚ÇÖ',
                        '6': '‚ÇÜ', '7': '‚Çá', '8': '‚Çà', '9': '‚Çâ'
                    };
                    return num.split('').map(d => subscripts[d] || d).join('');
                })
                
                // S√≠mbolos
                .replace(/\\pm/g, '¬±')
                .replace(/\\mp/g, '‚àì')
                .replace(/\\times/g, '√ó')
                .replace(/\\div/g, '√∑')
                .replace(/\\neq/g, '‚â†')
                .replace(/\\leq/g, '‚â§')
                .replace(/\\geq/g, '‚â•')
                .replace(/\\approx/g, '‚âà')
                .replace(/\\infty/g, '‚àû')
                
                // Ra√≠zes
                .replace(/\\sqrt\{([^}]+)\}/g, '‚àö$1')
                
                // Letras gregas
                .replace(/\\alpha/g, 'Œ±')
                .replace(/\\beta/g, 'Œ≤')
                .replace(/\\gamma/g, 'Œ≥')
                .replace(/\\delta/g, 'Œ¥')
                .replace(/\\epsilon/g, 'Œµ')
                .replace(/\\theta/g, 'Œ∏')
                .replace(/\\lambda/g, 'Œª')
                .replace(/\\mu/g, 'Œº')
                .replace(/\\pi/g, 'œÄ')
                .replace(/\\sigma/g, 'œÉ')
                .replace(/\\phi/g, 'œÜ')
                .replace(/\\omega/g, 'œâ');
        }
        
        function testUnicodeConversion() {
            const testCases = [
                '(\\sin^2(x) + \\cos^2(x) = 1)',
                '(1 + \\tan^2(x) = \\sec^2(x))',
                '(\\sin(a + b) = \\sin(a)\\cos(b) + \\cos(a)\\sin(b))',
                '(\\cos(a + b) = \\cos(a)\\cos(b) - \\sin(a)\\sin(b))',
                '(\\tan(a + b) = \\frac{\\tan(a) + \\tan(b)}{1 - \\tan(a)\\tan(b)})'
            ];
            
            let results = '<h3>Resultados dos Testes:</h3>';
            
            testCases.forEach((test, index) => {
                const result = convertMathToUnicode(test);
                const passed = result !== test; // Se mudou, funcionou
                
                results += `
                    <div class="formula">
                        <div class="original">Teste ${index + 1}: ${test}</div>
                        <div class="converted">Resultado: ${result}</div>
                        <div class="status ${passed ? 'working' : 'problem'}">
                            ${passed ? '‚úÖ FUNCIONANDO' : '‚ùå PROBLEMA'}
                        </div>
                    </div>
                `;
            });
            
            document.getElementById('test-results').innerHTML = results;
        }
        
        function testRealWorldExample() {
            // Simular o conte√∫do que estava aparecendo na imagem
            const realWorldContent = `
                Aqu√≠ tienes un resumen de algunas de las f√≥rmulas m√°s importantes en trigonometr√≠a:
                
                Identidades Trigonom√©tricas Fundamentales
                
                1. Identidades b√°sicas:
                (\\sin^2(x) + \\cos^2(x) = 1)
                (1 + \\tan^2(x) = \\sec^2(x))
                (1 + \\cot^2(x) = \\csc^2(x))
                
                Funciones Trigonom√©tricas Rec√≠procas
                (\\sin(x) = \\frac{1}{\\csc(x)})
                (\\cos(x) = \\frac{1}{\\sec(x)})
                (\\tan(x) = \\frac{1}{\\cot(x)})
                
                F√≥rmulas de Adici√≥n y Sustracci√≥n
                1. Suma:
                (\\sin(a + b) = \\sin(a)\\cos(b) + \\cos(a)\\sin(b))
                (\\cos(a + b) = \\cos(a)\\cos(b) - \\sin(a)\\sin(b))
            `;
            
            const converted = convertMathToUnicode(realWorldContent);
            
            let results = '<h3>Exemplo do Mundo Real:</h3>';
            results += `
                <div class="formula">
                    <h4>Conte√∫do Original (com problemas):</h4>
                    <div class="original">${realWorldContent.replace(/\n/g, '<br>')}</div>
                </div>
                <div class="formula">
                    <h4>Ap√≥s Convers√£o Unicode:</h4>
                    <div class="converted">${converted.replace(/\n/g, '<br>')}</div>
                </div>
            `;
            
            document.getElementById('test-results').innerHTML = results;
        }
        
        // Executar teste inicial
        testUnicodeConversion();
    </script>
</body>
</html>
