<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste - Melhorias nos Slides de Li√ß√µes</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        h1 {
            color: #1f2937;
            text-align: center;
            margin-bottom: 30px;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            background-color: #f9fafb;
        }
        .test-title {
            font-size: 18px;
            font-weight: 600;
            color: #374151;
            margin-bottom: 15px;
        }
        .test-content {
            background: white;
            padding: 15px;
            border-radius: 6px;
            border: 1px solid #d1d5db;
        }
        .slide-info {
            margin: 10px 0;
            padding: 10px;
            background: #f3f4f6;
            border-radius: 4px;
            font-family: monospace;
            font-size: 14px;
        }
        .success {
            color: #059669;
            font-weight: 600;
        }
        .error {
            color: #dc2626;
            font-weight: 600;
        }
        .warning {
            color: #d97706;
            font-weight: 600;
        }
        button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        button:hover {
            background: #2563eb;
        }
        button:disabled {
            background: #9ca3af;
            cursor: not-allowed;
        }
        .loading {
            display: none;
            text-align: center;
            color: #6b7280;
        }
        .results {
            margin-top: 20px;
        }
        .question-structure {
            background: #fef3c7;
            border: 1px solid #f59e0b;
            border-radius: 4px;
            padding: 10px;
            margin: 10px 0;
        }
        .option {
            margin: 5px 0;
            padding: 5px;
            background: #f9fafb;
            border-radius: 3px;
        }
        .correct-answer {
            background: #dcfce7;
            border: 1px solid #16a34a;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Teste - Melhorias nos Slides de Li√ß√µes</h1>
        
        <div class="test-section">
            <div class="test-title">üìù Teste 1: Slide de Explica√ß√£o (Slide 1)</div>
            <div class="test-content">
                <button onclick="testExplanationSlide()">Gerar Slide de Explica√ß√£o</button>
                <div class="loading" id="loading1">‚è≥ Gerando slide...</div>
                <div class="results" id="results1"></div>
            </div>
        </div>

        <div class="test-section">
            <div class="test-title">‚ùì Teste 2: Slide de Pergunta (Slide 4)</div>
            <div class="test-content">
                <button onclick="testQuestionSlide()">Gerar Slide de Pergunta</button>
                <div class="loading" id="loading2">‚è≥ Gerando slide...</div>
                <div class="results" id="results2"></div>
            </div>
        </div>

        <div class="test-section">
            <div class="test-title">üèÅ Teste 3: Slide de Encerramento (Slide 9)</div>
            <div class="test-content">
                <button onclick="testClosingSlide()">Gerar Slide de Encerramento</button>
                <div class="loading" id="loading3">‚è≥ Gerando slide...</div>
                <div class="results" id="results3"></div>
            </div>
        </div>

        <div class="test-section">
            <div class="test-title">üéØ Teste Completo: Li√ß√£o Estruturada</div>
            <div class="test-content">
                <button onclick="testCompleteLesson()">Gerar Li√ß√£o Completa</button>
                <div class="loading" id="loading4">‚è≥ Gerando li√ß√£o completa...</div>
                <div class="results" id="results4"></div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = window.location.origin;

        async function testExplanationSlide() {
            const loading = document.getElementById('loading1');
            const results = document.getElementById('results1');
            
            loading.style.display = 'block';
            results.innerHTML = '';
            
            try {
                const response = await fetch(`${API_BASE}/api/slides`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        topic: 'Disney - Hist√≥ria e Impacto Cultural',
                        position: 1,
                        previousSlides: []
                    })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    const slide = data.slide;
                    
                    let html = `
                        <div class="slide-info">
                            <strong>T√≠tulo:</strong> ${slide.title}<br>
                            <strong>Tipo:</strong> ${slide.type}<br>
                            <strong>Tamanho do conte√∫do:</strong> ${slide.content.length} caracteres<br>
                            <strong>Image prompt:</strong> ${slide.image_prompt || 'N√£o fornecido'}
                        </div>
                        <div class="slide-info">
                            <strong>Conte√∫do:</strong><br>
                            ${slide.content.substring(0, 200)}${slide.content.length > 200 ? '...' : ''}
                        </div>
                    `;
                    
                    // Verificar se o conte√∫do √© extenso
                    if (slide.content.length >= 400) {
                        html += `<div class="success">‚úÖ Conte√∫do extenso: PASSOU (‚â•400 caracteres)</div>`;
                    } else {
                        html += `<div class="error">‚ùå Conte√∫do muito pequeno: FALHOU (<400 caracteres)</div>`;
                    }
                    
                    // Verificar se tem image prompt
                    if (slide.image_prompt) {
                        html += `<div class="success">‚úÖ Image prompt: PASSOU</div>`;
                    } else {
                        html += `<div class="warning">‚ö†Ô∏è Image prompt: N√£o fornecido</div>`;
                    }
                    
                    results.innerHTML = html;
                } else {
                    results.innerHTML = `<div class="error">‚ùå Erro ao gerar slide: ${response.status}</div>`;
                }
            } catch (error) {
                results.innerHTML = `<div class="error">‚ùå Erro: ${error.message}</div>`;
            } finally {
                loading.style.display = 'none';
            }
        }

        async function testQuestionSlide() {
            const loading = document.getElementById('loading2');
            const results = document.getElementById('results2');
            
            loading.style.display = 'block';
            results.innerHTML = '';
            
            try {
                const response = await fetch(`${API_BASE}/api/slides`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        topic: 'Disney - Hist√≥ria e Impacto Cultural',
                        position: 4,
                        previousSlides: []
                    })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    const slide = data.slide;
                    
                    let html = `
                        <div class="slide-info">
                            <strong>T√≠tulo:</strong> ${slide.title}<br>
                            <strong>Tipo:</strong> ${slide.type}<br>
                            <strong>Pergunta:</strong> ${slide.question_stem || 'N√£o fornecida'}<br>
                            <strong>Op√ß√µes:</strong> ${slide.options ? slide.options.length : 0} op√ß√µes<br>
                            <strong>Resposta correta:</strong> ${slide.answer || 'N√£o fornecida'}<br>
                            <strong>Explica√ß√£o:</strong> ${slide.rationale ? 'Fornecida' : 'N√£o fornecida'}
                        </div>
                    `;
                    
                    if (slide.question_stem && slide.options) {
                        html += `<div class="question-structure">`;
                        html += `<strong>Pergunta:</strong> ${slide.question_stem}<br><br>`;
                        html += `<strong>Op√ß√µes:</strong><br>`;
                        slide.options.forEach((option, index) => {
                            const isCorrect = slide.answer === String.fromCharCode(65 + index);
                            html += `<div class="option ${isCorrect ? 'correct-answer' : ''}">`;
                            html += `${String.fromCharCode(65 + index)}. ${option}`;
                            if (isCorrect) html += ' ‚úÖ';
                            html += `</div>`;
                        });
                        html += `<br><strong>Explica√ß√£o:</strong> ${slide.rationale || 'N√£o fornecida'}`;
                        html += `</div>`;
                    }
                    
                    // Verificar estrutura da pergunta
                    const hasValidStructure = slide.question_stem && 
                                           slide.options && 
                                           slide.options.length === 4 && 
                                           slide.answer && 
                                           ['A', 'B', 'C', 'D'].includes(slide.answer) &&
                                           slide.rationale;
                    
                    if (hasValidStructure) {
                        html += `<div class="success">‚úÖ Estrutura da pergunta: PASSOU</div>`;
                    } else {
                        html += `<div class="error">‚ùå Estrutura da pergunta: FALHOU</div>`;
                        html += `<div class="error">Problemas encontrados:</div>`;
                        if (!slide.question_stem) html += `<div class="error">- question_stem ausente</div>`;
                        if (!slide.options || slide.options.length !== 4) html += `<div class="error">- options inv√°lidas</div>`;
                        if (!slide.answer || !['A', 'B', 'C', 'D'].includes(slide.answer)) html += `<div class="error">- answer inv√°lida</div>`;
                        if (!slide.rationale) html += `<div class="error">- rationale ausente</div>`;
                    }
                    
                    results.innerHTML = html;
                } else {
                    results.innerHTML = `<div class="error">‚ùå Erro ao gerar slide: ${response.status}</div>`;
                }
            } catch (error) {
                results.innerHTML = `<div class="error">‚ùå Erro: ${error.message}</div>`;
            } finally {
                loading.style.display = 'none';
            }
        }

        async function testClosingSlide() {
            const loading = document.getElementById('loading3');
            const results = document.getElementById('results3');
            
            loading.style.display = 'block';
            results.innerHTML = '';
            
            try {
                const response = await fetch(`${API_BASE}/api/slides`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        topic: 'Disney - Hist√≥ria e Impacto Cultural',
                        position: 9,
                        previousSlides: []
                    })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    const slide = data.slide;
                    
                    let html = `
                        <div class="slide-info">
                            <strong>T√≠tulo:</strong> ${slide.title}<br>
                            <strong>Tipo:</strong> ${slide.type}<br>
                            <strong>Tamanho do conte√∫do:</strong> ${slide.content.length} caracteres<br>
                            <strong>Image prompt:</strong> ${slide.image_prompt || 'N√£o fornecido'}
                        </div>
                        <div class="slide-info">
                            <strong>Conte√∫do:</strong><br>
                            ${slide.content.substring(0, 200)}${slide.content.length > 200 ? '...' : ''}
                        </div>
                    `;
                    
                    // Verificar se o conte√∫do √© extenso
                    if (slide.content.length >= 400) {
                        html += `<div class="success">‚úÖ Conte√∫do extenso: PASSOU (‚â•400 caracteres)</div>`;
                    } else {
                        html += `<div class="error">‚ùå Conte√∫do muito pequeno: FALHOU (<400 caracteres)</div>`;
                    }
                    
                    // Verificar se tem image prompt
                    if (slide.image_prompt) {
                        html += `<div class="success">‚úÖ Image prompt no slide 9: PASSOU</div>`;
                    } else {
                        html += `<div class="error">‚ùå Image prompt no slide 9: FALHOU</div>`;
                    }
                    
                    results.innerHTML = html;
                } else {
                    results.innerHTML = `<div class="error">‚ùå Erro ao gerar slide: ${response.status}</div>`;
                }
            } catch (error) {
                results.innerHTML = `<div class="error">‚ùå Erro: ${error.message}</div>`;
            } finally {
                loading.style.display = 'none';
            }
        }

        async function testCompleteLesson() {
            const loading = document.getElementById('loading4');
            const results = document.getElementById('results4');
            
            loading.style.display = 'block';
            results.innerHTML = '';
            
            try {
                const response = await fetch(`${API_BASE}/api/generate-lesson`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        topic: 'Disney - Hist√≥ria e Impacto Cultural',
                        demoMode: true
                    })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    const lesson = data.lesson;
                    
                    let html = `
                        <div class="slide-info">
                            <strong>T√≠tulo da Li√ß√£o:</strong> ${lesson.title}<br>
                            <strong>Mat√©ria:</strong> ${lesson.subject}<br>
                            <strong>N√≠vel:</strong> ${lesson.level}<br>
                            <strong>N√∫mero de slides:</strong> ${lesson.slides ? lesson.slides.length : 0}
                        </div>
                    `;
                    
                    if (lesson.slides) {
                        html += `<div class="slide-info">`;
                        html += `<strong>An√°lise dos Slides:</strong><br>`;
                        
                        let totalContentLength = 0;
                        let slidesWithImages = 0;
                        let questionSlides = 0;
                        let validQuestionSlides = 0;
                        
                        lesson.slides.forEach((slide, index) => {
                            totalContentLength += slide.content ? slide.content.length : 0;
                            if (slide.imagePrompt) slidesWithImages++;
                            if (slide.type === 'question') {
                                questionSlides++;
                                if (slide.question && slide.options && slide.options.length === 4 && slide.correctAnswer !== undefined) {
                                    validQuestionSlides++;
                                }
                            }
                        });
                        
                        const avgContentLength = totalContentLength / lesson.slides.length;
                        
                        html += `- Tamanho m√©dio do conte√∫do: ${Math.round(avgContentLength)} caracteres<br>`;
                        html += `- Slides com imagens: ${slidesWithImages}/${lesson.slides.length}<br>`;
                        html += `- Slides de pergunta: ${questionSlides}<br>`;
                        html += `- Perguntas v√°lidas: ${validQuestionSlides}/${questionSlides}<br>`;
                        html += `</div>`;
                        
                        // Verifica√ß√µes
                        if (avgContentLength >= 400) {
                            html += `<div class="success">‚úÖ Conte√∫do extenso: PASSOU (m√©dia ‚â•400 caracteres)</div>`;
                        } else {
                            html += `<div class="error">‚ùå Conte√∫do muito pequeno: FALHOU (m√©dia <400 caracteres)</div>`;
                        }
                        
                        if (slidesWithImages >= 2) {
                            html += `<div class="success">‚úÖ Imagens nos slides 1 e 9: PASSOU</div>`;
                        } else {
                            html += `<div class="warning">‚ö†Ô∏è Imagens nos slides: ${slidesWithImages} slides com imagens</div>`;
                        }
                        
                        if (validQuestionSlides === questionSlides && questionSlides > 0) {
                            html += `<div class="success">‚úÖ L√≥gica das perguntas: PASSOU</div>`;
                        } else {
                            html += `<div class="error">‚ùå L√≥gica das perguntas: FALHOU (${validQuestionSlides}/${questionSlides} v√°lidas)</div>`;
                        }
                    }
                    
                    results.innerHTML = html;
                } else {
                    results.innerHTML = `<div class="error">‚ùå Erro ao gerar li√ß√£o: ${response.status}</div>`;
                }
            } catch (error) {
                results.innerHTML = `<div class="error">‚ùå Erro: ${error.message}</div>`;
            } finally {
                loading.style.display = 'none';
            }
        }
    </script>
</body>
</html>
