<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste de Formata√ß√£o do Chat</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .message {
            margin: 20px 0;
            padding: 15px;
            border-radius: 10px;
            background: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .user-message {
            background: #fef3c7;
            margin-left: 50px;
        }
        .assistant-message {
            background: white;
            margin-right: 50px;
        }
        .message-header {
            font-weight: bold;
            margin-bottom: 10px;
            color: #666;
        }
        .message-content {
            line-height: 1.6;
        }
        .test-section {
            margin: 30px 0;
            padding: 20px;
            background: #e0f2fe;
            border-radius: 10px;
        }
        .test-button {
            background: #2563eb;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #1d4ed8;
        }
        .debug-info {
            background: #f3f4f6;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            margin-top: 10px;
        }
        /* Estilos para markdown */
        .markdown-content h1, .markdown-content h2, .markdown-content h3 {
            color: #1f2937;
            margin-top: 20px;
            margin-bottom: 10px;
        }
        .markdown-content h1 { font-size: 1.5em; }
        .markdown-content h2 { font-size: 1.3em; }
        .markdown-content h3 { font-size: 1.1em; }
        .markdown-content p { margin-bottom: 10px; }
        .markdown-content strong { font-weight: bold; }
        .markdown-content em { font-style: italic; }
        .markdown-content ul, .markdown-content ol { margin-left: 20px; margin-bottom: 10px; }
        .markdown-content li { margin-bottom: 5px; }
        .markdown-content code {
            background: #f1f5f9;
            padding: 2px 4px;
            border-radius: 3px;
            font-family: monospace;
        }
        .markdown-content pre {
            background: #f1f5f9;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>üß™ Teste de Formata√ß√£o do Chat</h1>
    
    <div class="test-section">
        <h2>Problema Reportado</h2>
        <p>No chat, a primeira mensagem √© formatada corretamente (com markdown), mas a segunda mensagem sai "crua" (sem formata√ß√£o markdown).</p>
        
        <button class="test-button" onclick="testFirstMessage()">Testar Primeira Mensagem</button>
        <button class="test-button" onclick="testSecondMessage()">Testar Segunda Mensagem</button>
        <button class="test-button" onclick="testBothMessages()">Testar Ambas</button>
        <button class="test-button" onclick="clearTest()">Limpar Teste</button>
    </div>

    <div id="test-results"></div>

    <script>
        // Simular conte√∫do de mensagens com markdown
        const testMessages = [
            {
                id: 'msg-1',
                role: 'assistant',
                content: `# Primeira Mensagem

Esta √© a **primeira mensagem** do chat. Ela cont√©m:

- Lista com itens
- **Texto em negrito**
- *Texto em it√°lico*
- \`c√≥digo inline\`

## Subt√≠tulo

Aqui temos um subt√≠tulo com mais conte√∫do formatado.`,
                isStreaming: false,
                timestamp: new Date()
            },
            {
                id: 'msg-2', 
                role: 'assistant',
                content: `# Segunda Mensagem

Esta √© a **segunda mensagem** do chat. Ela tamb√©m deveria ter:

- Lista com itens
- **Texto em negrito**
- *Texto em it√°lico*
- \`c√≥digo inline\`

## Subt√≠tulo

Aqui temos outro subt√≠tulo com mais conte√∫do formatado.`,
                isStreaming: false,
                timestamp: new Date()
            }
        ];

        function renderMarkdown(content) {
            // Simula√ß√£o simples de renderiza√ß√£o markdown
            return content
                .replace(/^# (.*$)/gim, '<h1>$1</h1>')
                .replace(/^## (.*$)/gim, '<h2>$1</h2>')
                .replace(/^### (.*$)/gim, '<h3>$1</h3>')
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\*(.*?)\*/g, '<em>$1</em>')
                .replace(/`(.*?)`/g, '<code>$1</code>')
                .replace(/^- (.*$)/gim, '<li>$1</li>')
                .replace(/(<li>.*<\/li>)/s, '<ul>$1</ul>')
                .replace(/\n/g, '<br>');
        }

        function testFirstMessage() {
            const message = testMessages[0];
            renderMessage(message, 'Primeira Mensagem');
        }

        function testSecondMessage() {
            const message = testMessages[1];
            renderMessage(message, 'Segunda Mensagem');
        }

        function testBothMessages() {
            testMessages.forEach((message, index) => {
                renderMessage(message, `Mensagem ${index + 1}`);
            });
        }

        function renderMessage(message, label) {
            const resultsDiv = document.getElementById('test-results');
            
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message assistant-message';
            messageDiv.innerHTML = `
                <div class="message-header">${label} (ID: ${message.id})</div>
                <div class="message-content markdown-content">
                    ${renderMarkdown(message.content)}
                </div>
                <div class="debug-info">
                    <strong>Debug Info:</strong><br>
                    Content Length: ${message.content.length}<br>
                    Has Markdown: ${message.content.includes('**') || message.content.includes('#')}<br>
                    Timestamp: ${message.timestamp.toISOString()}<br>
                    Is Streaming: ${message.isStreaming}
                </div>
            `;
            
            resultsDiv.appendChild(messageDiv);
        }

        function clearTest() {
            document.getElementById('test-results').innerHTML = '';
        }

        // Teste autom√°tico ao carregar
        window.onload = function() {
            console.log('üß™ Teste de formata√ß√£o carregado');
            console.log('Mensagens de teste:', testMessages);
        };
    </script>
</body>
</html>
