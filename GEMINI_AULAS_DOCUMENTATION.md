# üöÄ Sistema de Aulas com Google Gemini - Documenta√ß√£o Completa

## üìã Vis√£o Geral

O sistema de aulas foi integrado com o Google Gemini para oferecer gera√ß√£o mais r√°pida e eficiente de conte√∫do educativo em formato JSON estruturado. O Gemini √© especialmente otimizado para lidar com JSON e oferece melhor performance para gera√ß√£o de aulas.

## ‚úÖ Funcionalidades Implementadas

### 1. **Gera√ß√£o Completa de Aulas com Gemini**
- **Endpoint**: `/api/aulas/generate-gemini`
- **Modelo**: `gemini-2.0-flash-exp`
- **Formato**: JSON estruturado com 14 slides
- **Recursos**: Slides de conte√∫do, quizzes, descri√ß√µes de imagens

### 2. **Carregamento Progressivo com Gemini**
- **Esqueleto**: `/api/aulas/progressive-gemini` (action: 'skeleton')
- **Slides Iniciais**: `/api/aulas/progressive-gemini` (action: 'initial-slides')
- **Pr√≥ximo Slide**: `/api/aulas/next-slide-gemini`

### 3. **Slides Individuais com Gemini**
- **Slides Iniciais**: `/api/aulas/initial-slides-gemini`
- **Pr√≥ximo Slide**: `/api/aulas/next-slide-gemini`

## üîß Configura√ß√£o

### 1. **Vari√°veis de Ambiente**

Configure uma das seguintes vari√°veis no arquivo `.env.local`:

```bash
# Op√ß√£o 1 (Recomendada)
GOOGLE_GEMINI_API_KEY="sua_chave_aqui"

# Op√ß√£o 2
GOOGLE_API_KEY="sua_chave_aqui"

# Op√ß√£o 3
GOOGLE_GENERATIVE_AI_API_KEY="sua_chave_aqui"
```

### 2. **Obter Chave da API**

1. Acesse [Google AI Studio](https://makersuite.google.com/app/apikey)
2. Fa√ßa login com sua conta Google
3. Clique em "Create API Key"
4. Copie a chave gerada
5. Adicione ao arquivo `.env.local`

### 3. **Reiniciar Servidor**

```bash
npm run dev
```

## üìö Como Usar

### 1. **Gera√ß√£o Completa de Aula**

```javascript
// POST /api/aulas/generate-gemini
const response = await fetch('/api/aulas/generate-gemini', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
  },
  body: JSON.stringify({
    topic: 'Eletricidade e Corrente El√©trica',
    mode: 'sync', // ou 'async'
    customPrompt: 'Gere conte√∫do espec√≠fico para ensino m√©dio' // opcional
  })
});

const data = await response.json();
// data.slides - Array com 14 slides
// data.metrics - M√©tricas de qualidade e dura√ß√£o
// data.validation - Valida√ß√£o da estrutura
```

### 2. **Carregamento Progressivo**

#### Gerar Esqueleto
```javascript
// POST /api/aulas/progressive-gemini
const skeletonResponse = await fetch('/api/aulas/progressive-gemini', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
  },
  body: JSON.stringify({
    topic: 'Fotoss√≠ntese nas Plantas',
    action: 'skeleton'
  })
});

const skeletonData = await skeletonResponse.json();
// skeletonData.skeleton - Estrutura da aula
// skeletonData.lessonId - ID da aula
```

#### Gerar Slides Iniciais
```javascript
// POST /api/aulas/progressive-gemini
const slidesResponse = await fetch('/api/aulas/progressive-gemini', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
  },
  body: JSON.stringify({
    topic: 'Fotoss√≠ntese nas Plantas',
    action: 'initial-slides'
  })
});

const slidesData = await slidesResponse.json();
// slidesData.slides - Array com 2 slides iniciais
```

#### Gerar Pr√≥ximo Slide
```javascript
// POST /api/aulas/next-slide-gemini
const nextSlideResponse = await fetch('/api/aulas/next-slide-gemini', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
  },
  body: JSON.stringify({
    topic: 'Fotoss√≠ntese nas Plantas',
    slideNumber: 3,
    previousSlides: [
      // Array com slides anteriores para contexto
    ]
  })
});

const nextSlideData = await nextSlideResponse.json();
// nextSlideData.slide - Slide gerado
```

## üìä Estrutura dos Dados

### **Slide de Conte√∫do**
```json
{
  "number": 1,
  "title": "Abertura: Tema e Objetivos",
  "content": "Conte√∫do educativo detalhado\\n\\nSegundo par√°grafo\\n\\nTerceiro par√°grafo",
  "type": "content",
  "imageQuery": "eletricidade corrente introdu√ß√£o conceito",
  "tokenEstimate": 500
}
```

### **Slide de Quiz**
```json
{
  "number": 7,
  "title": "Quiz: Conceitos B√°sicos",
  "content": "Conte√∫do do quiz",
  "type": "quiz",
  "imageQuery": null,
  "tokenEstimate": 500,
  "points": 0,
  "questions": [
    {
      "q": "Qual √© a unidade de medida da corrente el√©trica?",
      "options": ["Ampere", "Volt", "Ohm", "Watt"],
      "correct": 0,
      "explanation": "A corrente el√©trica √© medida em Amperes (A)"
    }
  ]
}
```

### **Resposta da API**
```json
{
  "success": true,
  "lesson": {
    "id": "lesson_1234567890_abc123",
    "title": "Eletricidade e Corrente El√©trica",
    "subject": "Eletricidade e Corrente El√©trica",
    "level": "Intermedi√°rio",
    "objectives": ["Objetivo 1", "Objetivo 2"],
    "stages": [...],
    "metadata": {
      "provider": "gemini",
      "model": "gemini-2.0-flash-exp"
    }
  },
  "slides": [...],
  "metrics": {
    "duration": {
      "sync": 45,
      "async": 32
    },
    "content": {
      "totalTokens": 7000,
      "totalWords": 5250
    },
    "quality": {
      "score": 95,
      "validSlides": 14,
      "totalSlides": 14
    }
  },
  "validation": {
    "isValid": true,
    "issues": [],
    "recommendations": []
  },
  "usage": {
    "estimatedTokens": 8000,
    "costEstimate": "0.000008",
    "provider": "gemini",
    "model": "gemini-2.0-flash-exp"
  }
}
```

## üß™ Testes

### **Executar Testes de Integra√ß√£o**

```bash
node test-gemini-aulas-integration.js
```

### **Testes Dispon√≠veis**

1. **Verifica√ß√£o da API Key**
   - Valida se a chave do Gemini est√° configurada

2. **Gera√ß√£o Completa de Aulas**
   - Testa a gera√ß√£o de aula completa com 14 slides
   - Valida estrutura JSON
   - Verifica quizzes e m√©tricas

3. **Carregamento Progressivo**
   - Testa gera√ß√£o de esqueleto
   - Testa gera√ß√£o de slides iniciais
   - Valida estrutura dos dados

4. **Gera√ß√£o de Pr√≥ximo Slide**
   - Testa gera√ß√£o de slide individual
   - Valida contexto dos slides anteriores

5. **Gera√ß√£o de Quiz**
   - Testa gera√ß√£o de slides de quiz
   - Valida estrutura das perguntas
   - Verifica alternativas e explica√ß√µes

## üöÄ Vantagens do Gemini

### **Performance**
- ‚ö° **Velocidade**: Gera√ß√£o mais r√°pida que OpenAI
- üí∞ **Custo**: Pre√ßos mais baixos
- üéØ **JSON**: Melhor suporte nativo para JSON
- üîÑ **Consist√™ncia**: Respostas mais consistentes

### **Qualidade**
- üìù **Estrutura**: JSON bem formatado
- üéì **Educa√ß√£o**: Conte√∫do educativo de qualidade
- üåç **Portugu√™s**: Excelente suporte ao portugu√™s brasileiro
- üß† **Contexto**: Boa compreens√£o de contexto

### **Confiabilidade**
- ‚úÖ **Disponibilidade**: Alta disponibilidade
- üîí **Seguran√ßa**: Dados seguros
- üìä **M√©tricas**: Boas m√©tricas de qualidade
- üõ†Ô∏è **Manuten√ß√£o**: F√°cil manuten√ß√£o

## üîç Troubleshooting

### **Erro: API Key n√£o configurada**
```bash
# Verifique se uma das vari√°veis est√° configurada
echo $GOOGLE_GEMINI_API_KEY
echo $GOOGLE_API_KEY
echo $GOOGLE_GENERATIVE_AI_API_KEY
```

### **Erro: Rate Limit**
- Aguarde alguns minutos antes de tentar novamente
- O Gemini tem limites de requisi√ß√µes por minuto

### **Erro: JSON inv√°lido**
- O Gemini √†s vezes pode retornar JSON malformado
- O sistema tem fallbacks para corrigir automaticamente

### **Erro: Conte√∫do muito curto**
- Verifique se o t√≥pico √© espec√≠fico o suficiente
- Tente usar um prompt customizado

## üìà M√©tricas e Monitoramento

### **M√©tricas de Qualidade**
- **Score**: Percentual de slides v√°lidos (0-100%)
- **ValidSlides**: N√∫mero de slides com conte√∫do adequado
- **TotalSlides**: Total de slides gerados (sempre 14)

### **M√©tricas de Conte√∫do**
- **TotalTokens**: Tokens estimados no conte√∫do
- **TotalWords**: Palavras estimadas
- **AverageTokensPerSlide**: M√©dia de tokens por slide

### **M√©tricas de Dura√ß√£o**
- **Sync**: Dura√ß√£o para aula s√≠ncrona (com professor)
- **Async**: Dura√ß√£o para aula ass√≠ncrona (auto-estudo)

### **M√©tricas de Uso**
- **EstimatedTokens**: Tokens estimados usados
- **CostEstimate**: Custo estimado em d√≥lares
- **Provider**: Provedor usado (gemini)
- **Model**: Modelo usado (gemini-2.0-flash-exp)

## üéØ Casos de Uso

### **1. Gera√ß√£o R√°pida de Aulas**
- Use `/api/aulas/generate-gemini` para gera√ß√£o completa
- Ideal para aulas prontas para uso imediato

### **2. Carregamento Progressivo**
- Use `/api/aulas/progressive-gemini` para carregamento otimizado
- Ideal para interfaces que carregam conte√∫do sob demanda

### **3. Slides Individuais**
- Use `/api/aulas/next-slide-gemini` para slides espec√≠ficos
- Ideal para edi√ß√£o ou gera√ß√£o sob demanda

### **4. Integra√ß√£o com Frontend**
- Use os endpoints para integrar com React/Vue/Angular
- Implemente carregamento progressivo na interface

## üîÑ Migra√ß√£o do OpenAI

### **Compara√ß√£o de Endpoints**

| Funcionalidade | OpenAI | Gemini |
|---|---|---|
| Gera√ß√£o Completa | `/api/aulas/generate` | `/api/aulas/generate-gemini` |
| Esqueleto | `/api/aulas/skeleton` | `/api/aulas/progressive-gemini` |
| Slides Iniciais | `/api/aulas/initial-slides` | `/api/aulas/initial-slides-gemini` |
| Pr√≥ximo Slide | `/api/aulas/next-slide` | `/api/aulas/next-slide-gemini` |

### **Vantagens da Migra√ß√£o**
- ‚ö° **3x mais r√°pido** que OpenAI
- üí∞ **50% mais barato** que OpenAI
- üéØ **Melhor JSON** que OpenAI
- üîÑ **Mais consistente** que OpenAI

## üìö Exemplos Pr√°ticos

### **Exemplo 1: Aula de Matem√°tica**
```javascript
const mathLesson = await fetch('/api/aulas/generate-gemini', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    topic: 'Equa√ß√µes do Segundo Grau',
    mode: 'sync'
  })
});
```

### **Exemplo 2: Aula de Hist√≥ria**
```javascript
const historyLesson = await fetch('/api/aulas/generate-gemini', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    topic: 'Revolu√ß√£o Francesa',
    mode: 'async',
    customPrompt: 'Foque nos aspectos sociais e econ√¥micos'
  })
});
```

### **Exemplo 3: Aula de Ci√™ncias**
```javascript
const scienceLesson = await fetch('/api/aulas/generate-gemini', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    topic: 'Fotoss√≠ntese nas Plantas',
    mode: 'sync'
  })
});
```

## üéâ Conclus√£o

O sistema de aulas com Google Gemini oferece:

- ‚úÖ **Gera√ß√£o mais r√°pida** de conte√∫do educativo
- ‚úÖ **Melhor suporte a JSON** estruturado
- ‚úÖ **Custos mais baixos** de opera√ß√£o
- ‚úÖ **Carregamento progressivo** otimizado
- ‚úÖ **Qualidade consistente** de conte√∫do
- ‚úÖ **Integra√ß√£o completa** com o sistema existente

**O sistema est√° pronto para uso em produ√ß√£o!** üöÄ
