<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API de Ilustra√ß√µes Educacionais - Teste</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        h1 {
            color: #2563eb;
            text-align: center;
            margin-bottom: 30px;
        }
        .section {
            margin-bottom: 40px;
            padding: 20px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            background: #f9fafb;
        }
        .section h2 {
            color: #374151;
            margin-top: 0;
            border-bottom: 2px solid #e5e7eb;
            padding-bottom: 10px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #374151;
        }
        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
        }
        button {
            background: #2563eb;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        button:hover {
            background: #1d4ed8;
        }
        button:disabled {
            background: #9ca3af;
            cursor: not-allowed;
        }
        .results {
            margin-top: 20px;
            padding: 20px;
            background: white;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
        }
        .image-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .image-card {
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            overflow: hidden;
            background: white;
        }
        .image-card img {
            width: 100%;
            height: 150px;
            object-fit: cover;
        }
        .image-info {
            padding: 15px;
        }
        .image-info h3 {
            margin: 0 0 10px 0;
            font-size: 14px;
            color: #374151;
        }
        .image-info p {
            margin: 0;
            font-size: 12px;
            color: #6b7280;
        }
        .badge {
            display: inline-block;
            padding: 4px 8px;
            background: #dbeafe;
            color: #1e40af;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            margin-right: 5px;
            margin-bottom: 5px;
        }
        .loading {
            text-align: center;
            color: #6b7280;
            font-style: italic;
        }
        .error {
            background: #fef2f2;
            border: 1px solid #fecaca;
            color: #dc2626;
            padding: 15px;
            border-radius: 6px;
            margin-top: 15px;
        }
        .success {
            background: #f0fdf4;
            border: 1px solid #bbf7d0;
            color: #166534;
            padding: 15px;
            border-radius: 6px;
            margin-top: 15px;
        }
        .code-block {
            background: #1f2937;
            color: #f9fafb;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            overflow-x: auto;
            margin-top: 15px;
        }
        .process-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        .process-card {
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 15px;
            background: white;
            cursor: pointer;
            transition: all 0.2s;
        }
        .process-card:hover {
            border-color: #2563eb;
            box-shadow: 0 2px 4px rgba(37, 100, 235, 0.1);
        }
        .process-card h3 {
            margin: 0 0 10px 0;
            color: #374151;
            font-size: 16px;
        }
        .process-card p {
            margin: 0 0 10px 0;
            color: #6b7280;
            font-size: 14px;
        }
        .process-meta {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        .meta-item {
            font-size: 12px;
            color: #6b7280;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üî¨ API de Ilustra√ß√µes Educacionais</h1>
        <p style="text-align: center; color: #6b7280; margin-bottom: 30px;">
            Teste a API para buscar imagens educacionais, especialmente processos cient√≠ficos como fotoss√≠ntese
        </p>

        <!-- Se√ß√£o de Busca Geral -->
        <div class="section">
            <h2>üîç Busca Geral de Ilustra√ß√µes</h2>
            <div class="form-group">
                <label for="searchQuery">Termo de Busca:</label>
                <input type="text" id="searchQuery" placeholder="Ex: fotoss√≠ntese, tabela peri√≥dica, movimento..." value="fotoss√≠ntese">
            </div>
            <div class="form-group">
                <label for="searchCategory">Categoria:</label>
                <select id="searchCategory">
                    <option value="">Todas as categorias</option>
                    <option value="biology">Biologia</option>
                    <option value="chemistry">Qu√≠mica</option>
                    <option value="physics">F√≠sica</option>
                    <option value="math">Matem√°tica</option>
                    <option value="history">Hist√≥ria</option>
                    <option value="geography">Geografia</option>
                    <option value="general">Geral</option>
                </select>
            </div>
            <div class="form-group">
                <label for="searchLimit">Limite de Resultados:</label>
                <select id="searchLimit">
                    <option value="5">5 imagens</option>
                    <option value="10" selected>10 imagens</option>
                    <option value="15">15 imagens</option>
                    <option value="20">20 imagens</option>
                </select>
            </div>
            <button onclick="searchImages()">Buscar Imagens</button>
            <button onclick="clearResults('general')">Limpar</button>
            
            <div id="generalResults" class="results" style="display: none;">
                <h3>Resultados da Busca Geral</h3>
                <div id="generalImages" class="image-grid"></div>
            </div>
        </div>

        <!-- Se√ß√£o de Processos Espec√≠ficos -->
        <div class="section">
            <h2>üß¨ Processos Educacionais Espec√≠ficos</h2>
            <div class="form-group">
                <label for="processSelect">Processo:</label>
                <select id="processSelect">
                    <option value="">Selecione um processo...</option>
                    <option value="fotossintese">Fotoss√≠ntese</option>
                    <option value="respira√ß√£o-celular">Respira√ß√£o Celular</option>
                    <option value="digest√£o">Digest√£o</option>
                    <option value="circula√ß√£o">Circula√ß√£o Sangu√≠nea</option>
                    <option value="mitose">Mitose</option>
                    <option value="meiose">Meiose</option>
                    <option value="evolu√ß√£o">Evolu√ß√£o</option>
                    <option value="qu√≠mica-org√¢nica">Qu√≠mica Org√¢nica</option>
                    <option value="tabela-peri√≥dica">Tabela Peri√≥dica</option>
                    <option value="movimento">Movimento</option>
                    <option value="eletricidade">Eletricidade</option>
                </select>
            </div>
            <div class="form-group">
                <label for="processLevel">N√≠vel Educacional:</label>
                <select id="processLevel">
                    <option value="fundamental">Fundamental</option>
                    <option value="medio" selected>M√©dio</option>
                    <option value="superior">Superior</option>
                </select>
            </div>
            <button onclick="searchProcessImages()">Buscar Imagens do Processo</button>
            <button onclick="clearResults('process')">Limpar</button>
            
            <div id="processResults" class="results" style="display: none;">
                <h3>Resultados do Processo</h3>
                <div id="processImages" class="image-grid"></div>
            </div>
        </div>

        <!-- Se√ß√£o de Lista de Processos -->
        <div class="section">
            <h2>üìö Processos Dispon√≠veis</h2>
            <button onclick="loadProcesses()">Carregar Lista de Processos</button>
            <button onclick="loadCategories()">Carregar Categorias</button>
            
            <div id="processesList" class="results" style="display: none;">
                <h3>Processos Educacionais Dispon√≠veis</h3>
                <div id="processesGrid" class="process-grid"></div>
            </div>
        </div>

        <!-- Se√ß√£o de Teste de API -->
        <div class="section">
            <h2>üß™ Teste de Endpoints</h2>
            <button onclick="testEndpoints()">Testar Todos os Endpoints</button>
            <button onclick="testPhotosynthesis()">Teste Espec√≠fico: Fotoss√≠ntese</button>
            
            <div id="testResults" class="results" style="display: none;">
                <h3>Resultados dos Testes</h3>
                <div id="testOutput"></div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = '/api/illustrations';
        
        // Fun√ß√£o para buscar imagens gerais
        async function searchImages() {
            const query = document.getElementById('searchQuery').value;
            const category = document.getElementById('searchCategory').value;
            const limit = parseInt(document.getElementById('searchLimit').value);
            
            if (!query.trim()) {
                showError('generalResults', 'Digite um termo de busca');
                return;
            }
            
            showLoading('generalResults');
            
            try {
                const response = await fetch(`${API_BASE}/search`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        query: query.trim(),
                        category: category || undefined,
                        limit: limit,
                        includeMetadata: true
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    displayImages('generalImages', data.data);
                    showSuccess('generalResults', `Encontradas ${data.data.length} imagens`);
                } else {
                    showError('generalResults', data.error || 'Erro na busca');
                }
            } catch (error) {
                showError('generalResults', 'Erro de conex√£o: ' + error.message);
            }
        }
        
        // Fun√ß√£o para buscar imagens de processo espec√≠fico
        async function searchProcessImages() {
            const process = document.getElementById('processSelect').value;
            const level = document.getElementById('processLevel').value;
            
            if (!process) {
                showError('processResults', 'Selecione um processo');
                return;
            }
            
            showLoading('processResults');
            
            try {
                const response = await fetch(`${API_BASE}/processes`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        process: process,
                        level: level,
                        limit: 8,
                        includeSteps: true,
                        includeDiagrams: true
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    displayImages('processImages', data.images);
                    showSuccess('processResults', `Processo: ${data.process.name} - ${data.images.length} imagens encontradas`);
                    
                    // Mostrar informa√ß√µes do processo
                    if (data.process.steps) {
                        const stepsHtml = data.process.steps.map((step, index) => 
                            `<div class="meta-item">${index + 1}. ${step}</div>`
                        ).join('');
                        document.getElementById('processResults').innerHTML += 
                            `<div style="margin-top: 20px;"><h4>Etapas do Processo:</h4>${stepsHtml}</div>`;
                    }
                } else {
                    showError('processResults', data.error || 'Erro na busca do processo');
                }
            } catch (error) {
                showError('processResults', 'Erro de conex√£o: ' + error.message);
            }
        }
        
        // Fun√ß√£o para carregar lista de processos
        async function loadProcesses() {
            try {
                const response = await fetch(`${API_BASE}/processes?action=list`);
                const data = await response.json();
                
                if (data.success) {
                    displayProcesses(data.data);
                    showSuccess('processesList', `${data.data.length} processos carregados`);
                } else {
                    showError('processesList', data.error || 'Erro ao carregar processos');
                }
            } catch (error) {
                showError('processesList', 'Erro de conex√£o: ' + error.message);
            }
        }
        
        // Fun√ß√£o para carregar categorias
        async function loadCategories() {
            try {
                const response = await fetch(`${API_BASE}/search?action=categories`);
                const data = await response.json();
                
                if (data.success) {
                    displayCategories(data.data);
                    showSuccess('processesList', `${data.data.length} categorias carregadas`);
                } else {
                    showError('processesList', data.error || 'Erro ao carregar categorias');
                }
            } catch (error) {
                showError('processesList', 'Erro de conex√£o: ' + error.message);
            }
        }
        
        // Fun√ß√£o para testar todos os endpoints
        async function testEndpoints() {
            const output = document.getElementById('testOutput');
            output.innerHTML = '<div class="loading">Executando testes...</div>';
            document.getElementById('testResults').style.display = 'block';
            
            const tests = [
                { name: 'Lista de Processos', endpoint: `${API_BASE}/processes?action=list` },
                { name: 'Categorias', endpoint: `${API_BASE}/search?action=categories` },
                { name: 'Busca Fotoss√≠ntese', endpoint: `${API_BASE}/search`, method: 'POST', body: { query: 'fotoss√≠ntese', limit: 3 } },
                { name: 'Processo Fotoss√≠ntese', endpoint: `${API_BASE}/processes`, method: 'POST', body: { process: 'fotossintese', limit: 3 } }
            ];
            
            let results = '<h4>Resultados dos Testes:</h4>';
            
            for (const test of tests) {
                try {
                    const options = {
                        method: test.method || 'GET',
                        headers: { 'Content-Type': 'application/json' }
                    };
                    
                    if (test.body) {
                        options.body = JSON.stringify(test.body);
                    }
                    
                    const response = await fetch(test.endpoint, options);
                    const data = await response.json();
                    
                    results += `<div class="success" style="margin: 10px 0;">
                        <strong>‚úÖ ${test.name}:</strong> ${response.ok ? 'Sucesso' : 'Erro'} 
                        ${data.success ? `(${data.data?.length || 'N/A'} itens)` : `(${data.error})`}
                    </div>`;
                } catch (error) {
                    results += `<div class="error" style="margin: 10px 0;">
                        <strong>‚ùå ${test.name}:</strong> Erro de conex√£o - ${error.message}
                    </div>`;
                }
            }
            
            output.innerHTML = results;
        }
        
        // Fun√ß√£o para teste espec√≠fico de fotoss√≠ntese
        async function testPhotosynthesis() {
            const output = document.getElementById('testOutput');
            output.innerHTML = '<div class="loading">Testando fotoss√≠ntese...</div>';
            document.getElementById('testResults').style.display = 'block';
            
            try {
                // Teste 1: Busca geral
                const searchResponse = await fetch(`${API_BASE}/search`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        query: 'fotoss√≠ntese',
                        category: 'biology',
                        limit: 5
                    })
                });
                const searchData = await searchResponse.json();
                
                // Teste 2: Processo espec√≠fico
                const processResponse = await fetch(`${API_BASE}/processes`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        process: 'fotossintese',
                        level: 'medio',
                        limit: 5,
                        includeSteps: true
                    })
                });
                const processData = await processResponse.json();
                
                let results = '<h4>Teste Espec√≠fico: Fotoss√≠ntese</h4>';
                
                results += `<div class="success">
                    <strong>Busca Geral:</strong> ${searchData.success ? 
                        `${searchData.data.length} imagens encontradas` : 
                        `Erro: ${searchData.error}`}
                </div>`;
                
                results += `<div class="success">
                    <strong>Processo Espec√≠fico:</strong> ${processData.success ? 
                        `${processData.images.length} imagens + ${processData.process.steps?.length || 0} etapas` : 
                        `Erro: ${processData.error}`}
                </div>`;
                
                if (processData.success && processData.process) {
                    results += `<div class="code-block">
Processo: ${processData.process.name}
Descri√ß√£o: ${processData.process.description}
Categorias: ${processData.process.categories.join(', ')}
Dificuldade: ${processData.process.difficulty}
Faixa Et√°ria: ${processData.process.ageRange}
                    </div>`;
                }
                
                output.innerHTML = results;
            } catch (error) {
                output.innerHTML = `<div class="error">Erro no teste: ${error.message}</div>`;
            }
        }
        
        // Fun√ß√£o para exibir imagens
        function displayImages(containerId, images) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            
            images.forEach(image => {
                const imageCard = document.createElement('div');
                imageCard.className = 'image-card';
                imageCard.innerHTML = `
                    <img src="${image.thumbnail}" alt="${image.description}" loading="lazy">
                    <div class="image-info">
                        <h3>${image.description || 'Sem descri√ß√£o'}</h3>
                        <p><strong>Autor:</strong> ${image.author}</p>
                        <p><strong>Fonte:</strong> ${image.source}</p>
                        ${image.metadata ? `
                            <div class="badge">${image.metadata.category}</div>
                            <div class="badge">${Math.round(image.metadata.educationalRelevance * 100)}% relevante</div>
                        ` : ''}
                        ${image.tags && image.tags.length > 0 ? `
                            <p><strong>Tags:</strong> ${image.tags.slice(0, 3).join(', ')}</p>
                        ` : ''}
                    </div>
                `;
                container.appendChild(imageCard);
            });
        }
        
        // Fun√ß√£o para exibir processos
        function displayProcesses(processes) {
            const container = document.getElementById('processesGrid');
            container.innerHTML = '';
            
            processes.forEach(process => {
                const processCard = document.createElement('div');
                processCard.className = 'process-card';
                processCard.onclick = () => {
                    document.getElementById('processSelect').value = process.id;
                    searchProcessImages();
                };
                processCard.innerHTML = `
                    <h3>${process.name}</h3>
                    <p>${process.description}</p>
                    <div class="process-meta">
                        <div class="meta-item"><strong>Dificuldade:</strong> ${process.difficulty}</div>
                        <div class="meta-item"><strong>Idade:</strong> ${process.ageRange}</div>
                    </div>
                    <div style="margin-top: 10px;">
                        ${process.categories.map(cat => `<span class="badge">${cat}</span>`).join('')}
                    </div>
                `;
                container.appendChild(processCard);
            });
        }
        
        // Fun√ß√£o para exibir categorias
        function displayCategories(categories) {
            const container = document.getElementById('processesGrid');
            container.innerHTML = '';
            
            categories.forEach(category => {
                const categoryCard = document.createElement('div');
                categoryCard.className = 'process-card';
                categoryCard.innerHTML = `
                    <h3>${category.name}</h3>
                    <p>${category.description}</p>
                    <div class="process-meta">
                        <div class="meta-item"><strong>ID:</strong> ${category.id}</div>
                    </div>
                `;
                container.appendChild(categoryCard);
            });
        }
        
        // Fun√ß√µes auxiliares
        function showLoading(containerId) {
            const container = document.getElementById(containerId);
            container.style.display = 'block';
            container.innerHTML = '<div class="loading">Carregando...</div>';
        }
        
        function showError(containerId, message) {
            const container = document.getElementById(containerId);
            container.style.display = 'block';
            container.innerHTML = `<div class="error">${message}</div>`;
        }
        
        function showSuccess(containerId, message) {
            const container = document.getElementById(containerId);
            container.style.display = 'block';
            const existingContent = container.innerHTML;
            container.innerHTML = existingContent + `<div class="success">${message}</div>`;
        }
        
        function clearResults(type) {
            if (type === 'general') {
                document.getElementById('generalResults').style.display = 'none';
                document.getElementById('generalImages').innerHTML = '';
            } else if (type === 'process') {
                document.getElementById('processResults').style.display = 'none';
                document.getElementById('processImages').innerHTML = '';
            }
        }
        
        // Carregar processos ao inicializar
        window.onload = function() {
            loadProcesses();
        };
    </script>
</body>
</html>
